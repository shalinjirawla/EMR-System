<div class="lab-report-form">

  <!-- Patient Select -->
  <div class="form-group">
    <label for="patient">Select Patient</label>
    <p-dropdown
      [options]="patients"
      optionLabel="fullName"
      optionValue="id"
      placeholder="Select Patient"
      [(ngModel)]="selectedPatient"
      (onChange)="onPatientChange()"
      inputId="patient"
      class="pro-dropdown"
    ></p-dropdown>
  </div>

  <!-- Lab Test Source Select -->
  <div class="form-group">
    <label for="labTestSource">Select Source</label>
    <p-dropdown
      [options]="[
        { label: 'OPD', value: LabTestSource._0 },
        { label: 'Direct', value: LabTestSource._1 }
      ]"
      [(ngModel)]="labTestSource"
      optionLabel="label"
      optionValue="value"
      placeholder="Select Source"
      (onChange)="onLabTestSourceChange()"
      inputId="labTestSource"
      class="pro-dropdown"
    ></p-dropdown>
  </div>

  <!-- Prescription Select -->
  <div class="form-group" *ngIf="labTestSource === LabTestSource._0">
    <label for="prescription">Select Prescription</label>
    <p-dropdown
      [options]="prescriptions"
      optionLabel="prescriptionName"
      optionValue="id"
      placeholder="Select Prescription"
      [(ngModel)]="selectedPrescription"
      (onChange)="onPrescriptionChange($event.value)"
      inputId="prescription"
      class="pro-dropdown"
    ></p-dropdown>
  </div>

  <!-- Lab Tests MultiSelect -->
  <div class="form-group">
    <label for="labtests">Select Lab Tests</label>
    <p-multiSelect
      id="labtests"
      [options]="labTests"
      optionValue="id"
      optionLabel="name"
      [(ngModel)]="selectedLabTests"
      (onChange)="onLabTestsChange()"
      placeholder="Select Tests"
      selectedItemsLabel="{0} items selected"
      class="pro-multiselect"
      panelStyleClass="pro-panel"
    >
      <ng-template let-test pTemplate="item">
        <div [class.disabled-item]="test.disabled">
          {{ test.name }} - ₹{{ test.price }}
          <span *ngIf="test.disabled" class="included-text">(Included in package)</span>
        </div>
      </ng-template>
    </p-multiSelect>
  </div>

  <!-- Selected Tests & Total -->
  <section *ngIf="selectedTestDetails.length" class="selected-tests-container pro-card">
    <h4>Selected Tests</h4>
    <ul>
      <li *ngFor="let test of selectedTestDetails" class="test-item">
        <span>{{ test.name }}</span>
        <span>₹{{ test.price }}</span>
      </li>
    </ul>
    <div class="total-price">
      <strong>Total: ₹{{ selectedTestsTotalPrice }}</strong>
    </div>
  </section>

  <!-- Suggested Packages -->
  <section *ngIf="suggestions.length" class="suggestions-container pro-card">
    <h4>Suggested Packages</h4>
    <div *ngFor="let s of suggestions" class="suggestion-item">
      <div class="suggestion-info">
        <strong>{{ s.packageName }}</strong>
        <span class="suggestion-price">₹{{ s.packagePrice }}</span>
      </div>
      <button pButton type="button" label="Replace" (click)="replaceTests(s)" class="pro-btn"></button>
    </div>
  </section>

</div>
