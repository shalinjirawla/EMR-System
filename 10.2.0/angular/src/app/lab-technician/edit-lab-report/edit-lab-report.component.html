<form class="lab-report-form" autocomplete="off" #labResultEditForm="ngForm" (ngSubmit)="save()">
  <abp-modal-header title="Edit Lab Report - {{ testName }}" (onCloseClick)="bsModalRef.hide()"></abp-modal-header>

  <div class="modal-body">
    <div class="patient-info">
      <span class="label">Patient:</span>
      <span class="value">{{ patientName }}</span>
    </div>

    <div class="table-container" *ngIf="labReportItems.length > 0">
      <table class="lab-report-table">
        <thead>
          <tr>
            <th>Test</th>
            <th>Unit</th>
            <th>Min</th>
            <th>Max</th>
            <th>Result</th>
            <th>Flag</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of labReportItems; let i = index" [class.abnormal]="item.flag==='High' || item.flag==='Low'">
            <td>{{ item.test }}</td>
            <td>{{ item.unit || '–' }}</td>
            <td>{{ item.minValue ?? '–' }}</td>
            <td>{{ item.maxValue ?? '–' }}</td>
            <td>
              <input
                type="text"
                pInputText
                [(ngModel)]="item.result"
                [name]="'result' + i"
                placeholder="—"
                (ngModelChange)="calculateFlag(item)"
                class="result-input"
              />
            </td>
            <td><p-tag [severity]="getSeverity(item.flag)" [value]="item.flag || 'Unset'"></p-tag></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <abp-modal-footer [cancelDisabled]="saving" [saveDisabled]="isSaveDisabled()" (onCancelClick)="bsModalRef.hide()">
  </abp-modal-footer>
</form>
