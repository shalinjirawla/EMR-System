<div class="form-container" style="position: relative;">
  <div class="overlay" *ngIf="isSaving">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <form class="form-horizontal" autocomplete="off" #createProcedureForm="ngForm" (ngSubmit)="save()">
    <abp-modal-header title="Create Procedure Receipt" (onCloseClick)="bsModalRef.hide()"></abp-modal-header>

    <div class="modal-body">

      <!-- Patient Selection -->
      <div class="row">
        <div class="col-md-12">
          <label><b>Select Patient</b></label>
          <p-select 
            [options]="patients" 
            optionLabel="fullName" 
            optionValue="id" 
            placeholder="Select Patient"
            [(ngModel)]="selectedPatient" 
            name="patientId"
            (onChange)="onPatientChange()" 
            class="w-100" 
            required>
          </p-select>
        </div>
      </div>

      <!-- Prescription Selection -->
      <div class="row mt-3" *ngIf="prescriptions.length">
        <div class="col-md-12">
          <label><b>Select Prescription</b></label>
          <p-select
            [options]="prescriptions"
            optionLabel="prescriptionName"
            optionValue="id"
            placeholder="Select Prescription"
            [(ngModel)]="selectedPrescription"
            name="prescriptionId"
            (onChange)="onPrescriptionChange($event.value)"
            class="w-100"
            required>
          </p-select>
        </div>
      </div>

      <!-- Procedures List -->
      <div class="row mt-3" *ngIf="selectedProcedures.length">
        <div class="col-md-12">
          <h5>Selected Procedures</h5>
          <ul class="list-group">
            <li *ngFor="let proc of selectedProcedures" class="list-group-item d-flex justify-content-between">
              <span>{{ proc.name }}</span>
              <span>â‚¹{{ proc.price }}</span>
            </li>
          </ul>
          <div class="mt-2 text-right">
            <strong>Total: â‚¹{{ totalAmount }}</strong>
          </div>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="row mt-3">
        <div class="col-md-12">
          <label>Payment Method</label>
          <div class="d-flex">
            <div class="payment-option" [class.active]="paymentMethod === PaymentMethod._1" (click)="setPaymentMethod(PaymentMethod._1)">
              ðŸ’³ Card
            </div>
            <div class="payment-option ml-2" [class.active]="paymentMethod === PaymentMethod._0" (click)="setPaymentMethod(PaymentMethod._0)">
              ðŸ’µ Cash
            </div>
          </div>
        </div>
      </div>

    </div>

    <abp-modal-footer 
      [cancelDisabled]="isSaving" 
      [saveDisabled]="!createProcedureForm.form.valid || !selectedProcedures.length || isSaving"
      (onCancelClick)="bsModalRef.hide()">
      <ng-container *ngIf="isSaving">
        <i class="pi pi-spin pi-spinner" style="margin-right: 8px;"></i> Saving...
      </ng-container>
    </abp-modal-footer>
  </form>
</div>
