<div class="prescription-card p-4 shadow-2 border-round" *ngIf="prescription">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h4 class="m-0">{{ prescription.tenantName }}</h4>
            <small class="text-muted">Pharmacy / Clinic</small>
        </div>
    </div>

    <!-- Title -->
    <h3 class="text-center mb-4" style="color: #007ad9;">E-Prescription ({{prescription.pharmacistPrescriptionId}})</h3>

    <!-- Patient Info -->
    <div class="row">
        <div class="col-lg-6"><strong>Patient Name:</strong> {{ prescription.patientName }}</div>
        <div class="col-lg-6"><strong>Patient ID:</strong> {{ prescription.patientId }}</div>
    </div>
    <div class="row mt-2">
        <div class="col-lg-6"><strong>DOB:</strong> {{ prescription.patientDateOfBirth | date:'dd/MM/yyyy' }}</div>
        <div class="col-lg-6"><strong>Gender:</strong> {{ prescription.gender }}
            ({{calculateAgeDisplay(prescription.patientDateOfBirth)}} old)</div>
    </div>
    <div class="row mt-2">
        <div class="col-lg-6"><strong>Prescription ID:</strong> {{ prescription.prescriptionId }}</div>
        <div class="col-lg-6"><strong>Issue Date:</strong> {{ prescription.issueDate | date:'dd/MM/yyyy' }}</div>
    </div>

    <!-- Prescription Items Table -->

    <div class="card mt-3">
        <p-table [value]="prescription?.prescriptionItems" [tableStyle]="{ 'min-width': '50rem' }">
            <ng-template #header>
                <tr>
                    <th>Medicine Name</th>
                    <th>Dosage</th>
                    <th>Frequency</th>
                    <th>Duration</th>
                    <th>Instructions</th>
                    <th>Qty</th>
                    <th>UnitPrice</th>
                </tr>
            </ng-template>
            <ng-template #body let-product>
                <tr>
                    <td>{{ product.medicineName }}</td>
                    <td>{{ product.dosage }}</td>
                    <td>{{ product.frequency }}</td>
                    <td>{{ product.duration }}</td>
                    <td>{{ product.instructions }}</td>
                    <td>{{ product.qty }}</td>
                    <td>{{ product.unitPrice }}</td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <!-- Pharmacy Notes and Payment Info -->
    <div class="mt-3">
        <p><strong>Pharmacy Notes:</strong> {{ prescription.pharmacyNotes || '-' }}</p>
        <p-tag [value]="getStatusLabel(prescription.collectionStatus)" *ngIf="prescription.collectionStatus!=1"
            [severity]="getStatusSeverity(prescription.collectionStatus)" [rounded]="true">
        </p-tag>
        <p *ngIf="prescription.collectionStatus !=0">
            <strong>PickedUp By:</strong>
            <span *ngIf="prescription.pickedUpByNurse">{{prescription.pickedUpByNurse}}</span>
            <span *ngIf="!prescription.pickedUpByNurse"> {{prescription.patientName}} (Patient)</span>
        </p>
        <p><strong>Paid:</strong> <span [class.text-success]="prescription.isPaid"
                [class.text-danger]="!prescription.isPaid">{{ prescription.isPaid ? 'Yes' : 'No' }}</span></p>
        <p *ngIf="prescription.pickedUpByNurse"><strong>Picked Up By:</strong> {{ prescription.pickedUpByNurse }}</p>
        <p><strong>Grand Total:</strong> {{ prescription.grandTotal | currency }}</p>
    </div>

    <!-- Doctor Signature -->
    <div class="text-right mt-5">
        <p class="mb-0">Prescribed By</p>
        <h6 class="fw-bold">{{ prescription.doctorName }}</h6>
        <small>Reg No: {{ prescription.doctorRegistrationNumber }}</small>
    </div>
</div>