<div [@routerTransition]>
    <section class="content-header">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex flex-column">
                    <h4>Create</h4>
                    <div>
                        <p-breadcrumb [model]="items" />
                    </div>
                </div>
                <div>
                    <a (click)="gotList()" style="cursor: pointer;"><span class="pi pi-arrow-left mr-2"></span>Back to
                        list</a>
                </div>
            </div>
        </div>
    </section>
    <section class="content px-2 pb-5">
        <div class="container-fluid">
            <div class="card mb-0 table-wrapper">
                <div class="card-body">
                    <p-stepper [value]="2">
                        <div class="row">
                            <div class="col-md-3">
                                <p-step-list>
                                    <p-step [value]="1" class="mb-2 border  rounded w-100"> <i
                                            class="fa fa-info-circle mr-3"></i> Patient Details</p-step>
                                    <p-step [value]="2" class="mt-2 mb-2 border rounded w-100"> <i
                                            class="fa fa-clinic-medical mr-3"></i> Treatment Summary</p-step>
                                    <p-step [value]="3" class="mt-2 mb-2 border rounded  w-100"> <i
                                            class="fa-vial fas nav-icon mr-3"></i> Lab Results</p-step>
                                    <p-step [value]="4" class="mt-2 mb-2 border rounded w-100"> <i
                                            class="fa-file-invoice-dollar fas nav-icon mr-3"></i> Billing
                                        Summary</p-step>
                                    <p-step [value]="5" class="mt-2 mb-2 border rounded w-100"> <i
                                            class="pi pi-sign-out mr-3"></i> Discharge Instructions</p-step>
                                </p-step-list>
                            </div>
                            <div class="col-md-9">
                                <p-step-panels class="p-0">
                                    <p-step-panel [value]="1">
                                        <ng-template #content let-activateCallback="activateCallback">
                                            <div class="card">
                                                <div class="card-header">
                                                    <b>Basic Information</b>
                                                </div>
                                                <div class="card-body">
                                                    <p-avatar class="p-overlay-badge"
                                                        image="https://primefaces.org/cdn/primeng/images/demo/avatar/walter.jpg"
                                                        size="xlarge" />
                                                    <div class="row">
                                                        <div class="col-md-2 d-flex flex-column">
                                                            <label>ID</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.patientId" pSize="small"
                                                                readonly />
                                                        </div>
                                                        <div class="col-md-5 d-flex flex-column">
                                                            <label>First Name</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.firstName" pSize="small"
                                                                readonly />
                                                        </div>
                                                        <div class="col-md-5 d-flex flex-column">
                                                            <label>Last Name</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.lastName" pSize="small"
                                                                readonly />
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1">
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>User Name</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.userName" pSize="small"
                                                                readonly />
                                                        </div>
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Email Address</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.emailAddress"
                                                                pSize="small" readonly />
                                                        </div>
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Gender</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.gender" pSize="small"
                                                                readonly />
                                                        </div>
                                                    </div>
                                                    <div class="row mt-1">
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Dob</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.dob | date:'dd/MM/yyyy'"
                                                                pSize="small" readonly />
                                                        </div>
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Age</label>
                                                            <input type="text" pInputText
                                                                [value]="calculateAge(data?.patientDetails?.dob)"
                                                                pSize="small" readonly />
                                                        </div>
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Blood Group</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.bloodGroup" pSize="small"
                                                                readonly />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card mt-2">
                                                <div class="card-header">
                                                    <b>Contact Information</b>
                                                </div>
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Mobile Number</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.mobileNumber"
                                                                pSize="small" readonly />
                                                        </div>
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Emergency Number</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.emergencyNumber"
                                                                pSize="small" readonly />
                                                        </div>
                                                        <div class="col-md-4 d-flex flex-column">
                                                            <label>Emergency Name</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.emergencyPersonName"
                                                                pSize="small" readonly />
                                                        </div>
                                                        <div class="col-md-12 d-flex flex-column">
                                                            <label>Address</label>
                                                            <input type="text" pInputText
                                                                [value]="data?.patientDetails?.address" pSize="small"
                                                                readonly />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end">
                                                <button class="btn btn-sm next-btn " (click)="activateCallback(2)">
                                                    Next
                                                </button>
                                            </div>
                                        </ng-template>
                                    </p-step-panel>
                                    <p-step-panel [value]="2">
                                        <ng-template #content let-activateCallback="activateCallback">
                                            <div class="card">
                                                <div class="card-header">
                                                    <div class="d-flex justify-content-between">
                                                        <div>
                                                            <b>Vital Signs</b>
                                                        </div>
                                                        <div>
                                                            <p-badge [value]="vitalLenght" severity="secondary" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <p-table [value]="data?.vitals">
                                                        <ng-template #header>
                                                            <tr>
                                                                <th>Nurse Name</th>
                                                                <th>Department</th>
                                                                <th>Date</th>
                                                                <th></th>
                                                            </tr>
                                                        </ng-template>
                                                        <ng-template #body let-product>
                                                            <tr>
                                                                <td>{{ product.nurse.fullName }}</td>
                                                                <td>{{ product.nurse.department }}</td>
                                                                <td>{{ product.dateRecorded |date:'dd/MM/yyyy hh:mm a'
                                                                    }}</td>
                                                                <td>
                                                                    <span class="pi pi-eye"
                                                                        (click)="DisplayVitalDetails(product.id)"></span>
                                                                </td>
                                                            </tr>
                                                        </ng-template>
                                                    </p-table>
                                                </div>
                                            </div>
                                            <div class="card  mt-2">
                                                <div class="card-header">
                                                    <div class="d-flex justify-content-between">
                                                        <div>
                                                            <b>Total Prescriptions</b>
                                                        </div>
                                                        <div>
                                                            <p-badge [value]="prescriptionData?.length"
                                                                severity="secondary" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-body" *ngIf="prescriptionData">
                                                    <p-table [value]="prescriptionData">
                                                        <ng-template #header>
                                                            <tr>
                                                                <th>Diagnosis</th>
                                                                <th>Prescribed By</th>
                                                                <th>Issue Date</th>
                                                                <th></th>
                                                            </tr>
                                                        </ng-template>
                                                        <ng-template #body let-product1>
                                                            <tr>
                                                                <td>{{ product1.diagnosis }}</td>
                                                                <td>{{ product1.doctor.fullName }}</td>
                                                                <td>{{ product1.issueDate |date:'dd/MM/yyyy hh:mm a' }}
                                                                </td>
                                                                <td>
                                                                    <span class="pi pi-eye"
                                                                        (click)="ViewPharmacistPrescriptions(product1)"></span>
                                                                </td>
                                                            </tr>
                                                        </ng-template>
                                                    </p-table>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end">
                                                <button class="btn btn-sm next-btn " (click)="activateCallback(3)">
                                                    Next
                                                </button>
                                            </div>
                                        </ng-template>
                                    </p-step-panel>
                                    <p-step-panel [value]="3">
                                        <ng-template #content let-activateCallback="activateCallback">
                                            <div class="card">
                                                <div class="card-header">
                                                    <div class="d-flex justify-content-between">
                                                        <div>
                                                            <b>Total Lab Results</b>
                                                        </div>
                                                        <div>
                                                            <p-badge [value]="prescriptionLabTest?.length"
                                                                severity="secondary" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-body">
                                                    <p-table [value]="prescriptionLabTest">
                                                        <ng-template #header>
                                                            <tr>
                                                                <th>Test ID</th>
                                                                <th>Test Name</th>
                                                                <th>Status</th>
                                                                <th></th>
                                                            </tr>
                                                        </ng-template>
                                                        <ng-template #body let-product2>
                                                            <tr>
                                                                <td>#{{ product2.id }}</td>
                                                                <td>{{ product2.reportTypeName }}</td>
                                                                <td>
                                                                    <p-tag [value]="getStatusLabel(product2.testStatus)"
                                                                        [severity]="getStatusSeverity(product2.testStatus)"
                                                                        [rounded]="true">
                                                                    </p-tag>
                                                                </td>

                                                                <td>
                                                                    <div *ngIf="product2.testStatus>0">
                                                                        <button class="btn btn-sm btn-danger"
                                                                            (click)="ViewLabReport(product2.id)">
                                                                            <span class="fa-solid fa-clipboard"></span>
                                                                        </button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </ng-template>
                                                    </p-table>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-end">
                                                <button class="btn btn-sm next-btn " (click)="activateCallback(4)">
                                                    Next
                                                </button>
                                            </div>
                                        </ng-template>
                                    </p-step-panel>
                                </p-step-panels>
                            </div>
                        </div>
                    </p-stepper>
                </div>
            </div>
        </div>
    </section>
</div>

<div class="card flex justify-center">
    <p-dialog [(visible)]="visible" [modal]="true" [style]="{ width: '30rem' }">
        <ng-template #header>
            <h6><b>Vital Details</b></h6>
        </ng-template>
        <div class="row" *ngIf="showVitalDetails!=null">
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="fa-solid fa-temperature-three-quarters" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Temperature</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.temperature}} °C</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="fa-solid fa-lungs" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Respiratory Rate</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.respirationRate}} breaths/min</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="pi pi-info" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Height</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.height}} cm</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="fa-solid fa-weight-scale" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Weight</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.weight}} Kg</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="pi pi-calculator" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>BMI</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.bmi}} kg/cm</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="fa-solid fa-droplet" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Blood Pressure</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.bloodPressure}} mmHg</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="fa-solid fa-heart-pulse" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Heart Rate</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.heartRate}} bpm</p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="d-flex align-items-center mb-3">
                    <p-button icon="fa-solid fa-mask-ventilator" severity="secondary" class="mr-2" />
                    <div>
                        <h6 class="mb-1 text-truncate"><b>Oxygen Saturation</b>
                        </h6>
                        <p class="mb-0 fs-13 d-inline-flex align-items-center text-truncate">
                            {{showVitalDetails.oxygenSaturation}} %</p>
                    </div>
                </div>
            </div>
        </div>
    </p-dialog>
</div>