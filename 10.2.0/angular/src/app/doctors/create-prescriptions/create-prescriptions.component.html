<form class="form-horizontal" autocomplete="off" #prescriptionForm="ngForm" (ngSubmit)="save()">
  <abp-modal-header title="Create New Prescription" (onCloseClick)="bsModalRef.hide()"></abp-modal-header>

  <div class="modal-body">

    <!-- Patient Selection -->
    <div class="row">
      <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center">
          <b>Select Patient</b>
          <p-button label="Add New Patient" variant="text" severity="info" />
        </div>
        <p-select [(ngModel)]="prescription.patientId" name="patientId" [options]="patients" optionLabel="name"
          placeholder="Select a patient" class="w-100" required />
      </div>
    </div>

    <!-- Doctor Selection -->
    <div class="row mt-3">
      <div class="col-md-12">
        <label><b>Select Doctor</b></label>
        <p-select [(ngModel)]="prescription.doctorId" name="doctorId" [options]="doctors" optionLabel="fullName"
          placeholder="Select a doctor" class="w-100" required />
      </div>
    </div>

    <!-- Appointment Selection -->
    <div class="row mt-3">
      <div class="col-md-12">
        <label><b>Appointment</b></label>
        <p-select [(ngModel)]="prescription.appointmentId" name="appointmentId" [options]="appointments"
          optionLabel="title" placeholder="Select appointment" class="w-100" />
      </div>
    </div>

    <!-- Diagnosis -->
    <div class="row mt-3">
      <div class="col-md-12 d-flex flex-column">
        <label>Diagnosis</label>
        <input type="text" pInputText [(ngModel)]="prescription.diagnosis" name="diagnosis" required />
      </div>
    </div>

    <!-- Notes -->
    <div class="row mt-3">
      <div class="col-md-12 d-flex flex-column">
        <label>Notes</label>
        <textarea pTextarea [(ngModel)]="prescription.notes" name="notes" rows="3" class="w-100"></textarea>
      </div>
    </div>

    <!-- Issue Date & Follow-up -->
    <div class="row mt-3">
      <div class="col-md-6 d-flex flex-column">
        <label>Issue Date</label>
       <p-calendar [(ngModel)]="prescription" [showIcon]="true" [showOnFocus]="true"></p-calendar>

      </div>
      <div class="col-md-6 d-flex align-items-center mt-4">
        <p-checkbox [(ngModel)]="prescription.isFollowUpRequired" name="isFollowUpRequired" inputId="followup" />
        <label for="followup" class="ml-2"><b>Follow-up Required</b></label>
      </div>
    </div>

    <!-- Prescription Items Placeholder -->
    <div class="row mt-4">
      <div class="col-md-12">
        <label><b>Prescription Items</b></label>
        <!-- You can dynamically render prescription items list here -->
        <p-button label="Add Item" icon="pi pi-plus" class="p-button-sm" (click)="addItem()" />
        <div *ngFor="let item of prescription.items; let i = index" class="mt-2">
          <div class="d-flex">
            <input type="text" pInputText [(ngModel)]="item.name" name="itemName{{i}}" class="w-50 mr-2"
              placeholder="Medicine Name" />
            <input type="text" pInputText [(ngModel)]="item.dosage" name="itemDosage{{i}}" class="w-25 mr-2"
              placeholder="Dosage" />
            <p-button icon="pi pi-trash" severity="danger" class="p-button-sm" (click)="removeItem(i)" />
          </div>
        </div>
      </div>
    </div>

  </div>

  <abp-modal-footer [cancelDisabled]="saving" [saveDisabled]="!prescriptionForm.valid || saving"
    (onCancelClick)="bsModalRef.hide()">
  </abp-modal-footer>
</form>
