<div [@routerTransition]>
    <section class="content-header">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <p-breadcrumb [model]="items"></p-breadcrumb>
                </div>
                <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                    <div class="btn-group mr-1" role="group" aria-label="Refresh group" pTooltip="Refresh"
                        tooltipPosition="top" (click)="refresh()">
                        <button type="button" class="btn btn-md refresh-btn">
                            <span class="pi pi-refresh"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="content px-2 pb-5">
        <div class="container-fluid">
            <div class="card mb-0 table-wrapper">
                <div class="card-body table-responsive table-striped table-bordered">
                    <p-table #dataTable sortMode="multiple" [value]="primengTableHelper.records"
                        rows="{{ primengTableHelper.defaultRecordsCountPerPage }}" [paginator]="false" [lazy]="true"
                        [tableStyle]="{ 'min-width': '50rem' }" (onLazyLoad)="list($event)">
                        <ng-template #header>
                            <tr>
                                <th>Patient Name</th>
                                <th>Requesting Doctor</th>
                                <th *ngIf="showDoctorColumn">Requested Specialist</th>
                                <th>{{ 'Status' | localize }}</th>
                                <th>{{ 'Actions' | localize }}</th>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-record="$implicit">
                            <tr>
                                <td>{{ record.patientName }}</td>
                                <td>{{ record.requestingDoctorName }}</td>
                                <td *ngIf="showDoctorColumn">{{ record.requestedSpecialistName }}</td>
                                <td>
                                    <span [className]="getStatusSeverity(record.status)">
                                        {{getStatusLabel(record.status)}}
                                    </span>
                                </td>
                                <td>
                                    <button type="button" pButton icon="pi pi-eye" class="p-button-text"
                                        (click)="showDialog(record)"></button>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>

                    <div class="primeng-no-data text-center mt-2" *ngIf="primengTableHelper.totalRecordsCount == 0">
                        {{ 'NoData' | localize }}
                    </div>
                </div>

                <div class="card-footer table-card-footer bg-white border-top">                        
                        <div class="col-sm-8 col-12">
                            <div class="float-sm-right m-auto">
                                <p-paginator [rows]="primengTableHelper.defaultRecordsCountPerPage" #paginator
                                    (onPageChange)="list($event)" [totalRecords]="primengTableHelper.totalRecordsCount"
                                    [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
                                    [showCurrentPageReport]="true"
                                    [currentPageReportTemplate]="'TotalRecordsCount' | localize: primengTableHelper.totalRecordsCount">
                                </p-paginator>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </section>
</div>

<p-dialog [header]="selectedRecords?.patientName" [(visible)]="visible" [modal]="true"
    [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '40rem' }" [draggable]="false"
    [resizable]="false" (onHide)="OnDialogBoxHide()">
    <p>{{ selectedRecords?.notes }}</p>

    <div *ngIf="isInPending(selectedRecords?.status)" class="d-flex justify-content-end">
        <button pButton severity="info" (click)="UpdateStatus(selectedRecords, 1)">
            <span pButtonLabel>Review Request</span>
        </button>
    </div>

    <div *ngIf="isInReview(selectedRecords?.status)">
        <div class="row mt-3">
            <div class="col-md-12 d-flex flex-column">
                <label>Advice</label>
                <textarea rows="5" pTextarea [(ngModel)]="_adviceResponse"></textarea>
            </div>
        </div>
        <div class="d-flex justify-content-end gap-2 mt-3">
            <button pButton severity="success" (click)="UpdateStatus(selectedRecords, 2)">
                <i class="pi pi-check" pButtonIcon></i>
                <span pButtonLabel>Complete</span>
            </button>
        </div>
    </div>

    <div *ngIf="isCompleted(selectedRecords?.status)">
        <div class="row mt-3">
            <div class="col-md-12 d-flex flex-column">
                <label>Advice Response</label>
                <p>{{ selectedRecords?.adviceResponse }}</p>
            </div>
        </div>
        <p class="text-success mt-3 text-right"><i class="pi pi-check-circle"></i> Request Completed</p>
    </div>
</p-dialog>