<!-- lab-test-items.component.html -->
<div [@routerTransition]>
  <section class="content-header">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <p-breadcrumb [model]="items"></p-breadcrumb>
      <div class="btn-toolbar">
        <button type="button" class="btn btn-md refresh-btn mr-2" pTooltip="Refresh" tooltipPosition="top"
          (click)="list()">
          <span class="pi pi-refresh"></span>
        </button>
        <button type="button" class="btn btn-md add-btn" (click)="createReportType()">
          <span class="pi pi-plus-circle mr-2"></span> Add
        </button>
      </div>
    </div>
  </section>

  <section class="content px-2 pb-5">
    <div class="container-fluid">
      <div class="card table-wrapper">
        <div class="card-body table-responsive table-striped table-bordered">
          <p-table #dataTable [value]="reportTypes" [lazy]="true" [paginator]="false"
            [rows]="primengTableHelper.defaultRecordsCountPerPage" [totalRecords]="primengTableHelper.totalRecordsCount"
            [expandedRowKeys]="expandedRows" (onLazyLoad)="list($event)" (onRowExpand)="onRowExpand($event)"
            (onRowCollapse)="onRowCollapse($event)" dataKey="id" [tableStyle]="{ 'min-width': '30rem' }">
            <ng-template pTemplate="header">
              <tr>
                <th style="width:3em"></th>
                <th>{{ 'Name' | localize }}</th>
                <th></th>
              </tr>
            </ng-template>

            <ng-template #body let-type let-expanded="expanded">
              <tr>
                <td>
                  <p-button type="button" pRipple [pRowToggler]="type" [text]="true" [rounded]="true" [plain]="true"
                    [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
                </td>
                <td>{{ type.reportType }}</td>
                <td></td>
              </tr>
            </ng-template>

            <ng-template #expandedrow let-type>
              <tr>
                <!-- colspan = number of columns in the body (3 here) -->
                <td colspan="4">
                  <ng-container *ngIf="type.tests?.length; else noTests">
                    <p-table [value]="type.tests" [responsiveLayout]="'scroll'" class="p-datatable-sm"
                      [style]="{ 'width': '100%' }">
                      <ng-template pTemplate="header">
              <tr>
                <th>{{ 'Test Name' | localize }}</th>
                <th>{{ 'Measure Unit' | localize }}</th>
                <th>{{ 'Actions' | localize }}</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-test>
              <tr>
                <td>{{ test.labTestName }}</td>
                <td>{{ test.measureUnitName }}</td>
                <td>
                  <button class="btn btn-sm btn-danger" (click)="deleteTestItem(test.labReportTypeId, test.id)">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </ng-template>
          </p-table>

          </ng-container>
          <ng-template #noTests>
            <p class="text-sm text-gray-500 m-0">
              {{ 'No Tests Added' | localize }}
            </p>
          </ng-template>
          </td>
          </tr>
          </ng-template>
          </p-table>

          <div class="primeng-no-data text-center m-2" *ngIf="primengTableHelper.totalRecordsCount === 0">
            {{ 'NoData' | localize }}
          </div>
        </div>

        <p-paginator #paginator [rows]="primengTableHelper.defaultRecordsCountPerPage" (onPageChange)="list($event)"
          [totalRecords]="primengTableHelper.totalRecordsCount"
          [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage" [showCurrentPageReport]="true"
          [currentPageReportTemplate]="'TotalRecordsCount' | localize: primengTableHelper.totalRecordsCount">
        </p-paginator>
      </div>
    </div>
  </section>
</div>