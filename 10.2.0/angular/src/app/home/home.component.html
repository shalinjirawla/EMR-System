<div [@routerTransition]>
    <section class="content-header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <h1>Welcome, {{shownLoginName}}</h1>
                </div>
            </div>
        </div>
    </section>
    <section class="content px-2">
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl-3 col-md-6" *ngFor="let card of [
                {label:'Patients', value: summaryData?.totalPatients, chart: patientsChartData, color:'info'},
                {label:'Appointments', value: summaryData?.totalAppointments, chart: appointmentsChartData, color:'success'},
                {label:'Doctors', value: summaryData?.totalDoctors, chart: doctorsChartData, color:'warning'},
                {label:'Nurses', value: summaryData?.totalNurses, chart: nursesChartData, color:'danger'}
                ]">
                    <div class="card" *ngIf="card.value>0">
                        <div class="card-body d-flex flex-column">
                            <!-- Header: Icon + Label + Value -->
                            <div class="d-flex align-items-center overflow-hidden mb-2">
                                <p-button [icon]="'pi pi-user'" [rounded]="true" [severity]="card.color"></p-button>
                                <div class="ml-2 overflow-hidden">
                                    <p class="mb-1 text-truncate">{{card.label}}</p>
                                    <h5 class="mb-0">{{card.value}}</h5>
                                </div>
                            </div>

                            <!-- Chart -->
                            <div *ngIf="card.chart">
                                <p-chart type="line" [data]="card.chart" [options]="chartOptions"></p-chart>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6><b>Appointment Request</b></h6>
                                <div class="all-btn" [routerLink]="['/app/doctors/view-appointments']">All Appointments
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- <div *ngFor="let x of summaryData?.totalAppointmentList">
                                <div class="row">
                                    <div class="col-md-10">
                                        <div class="row">
                                            <div class="col-sm-2">
                                                <p-avatar [label]="getShortName(x.patient.fullName)" size="large" />
                                            </div>
                                            <div class="col-sm-10">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <h6><b>{{x.patient.fullName}}</b></h6>
                                                    </div>
                                                    <div class="col-12 d-flex align-items-center"
                                                        style="font-size: 0.8rem;">
                                                        <span class="pi-calendar-clock pi mr-2"></span>
                                                        <span>{{x.appointmentDate |date}}</span>
                                                        <span class="pi pi-clock ml-3 mr-2"></span>
                                                        <span>{{x.appointmentDate|date : ' hh:mm a'}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 d-flex align-items-center">
                                        <span class="badge badge-soft-success">{{x.department?.departmentName}}</span>
                                    </div>
                                </div>
                                <hr>
                            </div> -->
                            <p-table [value]="summaryData?.totalAppointmentList">
                                <ng-template #body let-product>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div>
                                                    <p-avatar [label]="getShortName(product.patient.fullName)"
                                                        size="large" />
                                                </div>
                                                <div class="ml-2 d-flex flex-column">
                                                    <div><b>{{ product.patient.fullName }}</b></div>
                                                    <div style="font-size: 0.8rem;">
                                                        <span class="pi-calendar-clock pi mr-2"></span>
                                                        <span>{{product.appointmentDate |date}}</span>
                                                        <span class="pi pi-clock ml-3 mr-2"></span>
                                                        <span>{{product.appointmentDate|date : ' hh:mm a'}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span
                                                class="badge badge-soft-success">{{product?.department?.departmentName}}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6><b>Patient Record</b></h6>
                                <div class="all-btn" [routerLink]="['/app/doctors/patients']">View All</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <p-table [value]="summaryData?.totalPatientList">
                                <ng-template #header>
                                    <tr>
                                        <th>Patient Name</th>
                                        <th>DOB</th>
                                        <th>Gender</th>
                                        <th>Active</th>
                                    </tr>
                                </ng-template>
                                <ng-template #body let-product>
                                    <tr>
                                        <td>{{ product.fullName }}</td>
                                        <td>{{ product.dateOfBirth |date :"dd/MM/yy"}}</td>
                                        <td>{{ getShortName(product.gender) }}</td>
                                        <td>
                                            <span class="badge badge-soft-success">{{product.abpUser.isActive}}</span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <a class="card">
                        <div class="card-body text-center">
                            <span
                                class="badge-soft-primary icon-txt rounded w-100 d-flex p-4 justify-content-center fs-32 mb-2">
                                <i class="fa-solid fa-users"></i>
                            </span>
                            <h6 class="fs-14 fw-semibold text-truncate mb-0">All Patient</h6>
                        </div>
                    </a>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <a class="card">
                        <div class="card-body text-center">
                            <span
                                class="badge-soft-success icon-txt rounded w-100 d-flex p-4 justify-content-center fs-32 mb-2 icon-txt">
                                <i class="fa-solid fa-user-doctor"></i>
                            </span>
                            <h6 class="fs-14 fw-semibold text-truncate mb-0">Doctors</h6>
                        </div>
                    </a>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <a class="card">
                        <div class="card-body text-center">
                            <span
                                class="badge-soft-warning icon-txt rounded w-100 d-flex p-4 justify-content-center fs-32 mb-2">
                                <i class="fa-solid fa-vials"></i>
                            </span>
                            <h6 class="fs-14 fw-semibold text-truncate mb-0">Labs Results</h6>
                        </div>
                    </a>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <a class="card">
                        <div class="card-body text-center">
                            <span
                                class="badge-soft-danger icon-txt rounded w-100 d-flex p-4 justify-content-center fs-32 mb-2">
                                <i class="fa-solid fa-prescription-bottle-medical"></i>
                            </span>
                            <h6 class="fs-14 fw-semibold text-truncate mb-0">Prescriptions</h6>
                        </div>
                    </a>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <a class="card">
                        <div class="card-body text-center">
                            <span
                                class="badge-soft-purple icon-txt rounded w-100 d-flex p-4 justify-content-center fs-32 mb-2">
                                <i class="fa-solid fa-user-nurse"></i>
                            </span>
                            <h6 class="fs-14 fw-semibold text-truncate mb-0">Nurses</h6>
                        </div>
                    </a>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <a class="card">
                        <div class="card-body text-center">
                            <span
                                class="badge-soft-teal icon-txt rounded w-100 d-flex p-4 justify-content-center fs-32 mb-2">
                                <i class="fa-solid fa-file"></i>
                            </span>
                            <h6 class="fs-14 fw-semibold text-truncate mb-0">Medical Results</h6>
                        </div>
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6><b>Top Departments</b></h6>
                                <div class="all-btn" [routerLink]="['/app/master/department']">View All</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-center position-relative">
                                <p-chart type="doughnut" [data]="departmentChartData" [options]="departmentChartOptions"
                                    style="width: 250px;"></p-chart>

                                <!-- Center overlay -->
                                <div class="position-absolute d-flex flex-column justify-content-center align-items-center"
                                    style="top: 100px; left: 57px;">
                                    <h6 class="mb-1">Appointments</h6>
                                    <h3 class="fw-bold">{{ summaryData?.totalAppointments }}</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6><b>Doctors</b></h6>
                                <div class="all-btn">View All</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <p-table [value]="summaryData?.totalDoctorList">
                                <ng-template #body let-product>
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div>
                                                    <p-avatar [label]="getShortName(product.fullName)" size="large" />
                                                </div>
                                                <div class="ml-2 d-flex flex-column">
                                                    <span><b>Dr. {{ product.fullName }}</b></span>
                                                    <span *ngIf="product?.department" style="font-size: 13px;">{{
                                                        product?.department?.departmentName }}</span>
                                                    <span *ngIf="!product?.department"
                                                        style="font-size: 13px;">Emergency</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge badge-soft-success"
                                                *ngIf="product.abpUser.isActive">Available</span>
                                            <span class="badge badge-soft-danger"
                                                *ngIf="!product.abpUser.isActive">UnAvailable</span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6><b>Medicines</b></h6>
                                <div class="all-btn" [routerLink]="['/app/pharmacist/medicine-list']">View All</div>
                            </div>
                        </div>
                        <div class="card-body">
                            <p-table [value]="summaryData?.totalMedicineList">
                                <ng-template #body let-product>
                                    <tr>
                                        <td>
                                            <span><b>{{ product.medicineName }}</b></span>
                                        </td>
                                        <td>
                                            <span class="badge badge-soft-success"
                                                *ngIf="product.isAvailable">Available</span>
                                        </td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>